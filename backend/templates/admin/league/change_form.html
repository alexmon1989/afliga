{% extends "admin/change_form.html" %}

{% block extrahead %}
    {{ block.super }}

    <script type="text/javascript" charset="utf-8">
        django.jQuery(function () {
            var $ = django.jQuery;

            // НАчальная фильтрация игроков
            $.each( $(".field-player select"), function( key, obj ) {
                var $playersSelect = $(obj);
                $playersSelect.prop("disabled", "disabled");

                // Текущее значение поля игрока
                var playerVal = $playersSelect.val();

                if (playerVal) {
                    // Поле команды
                    var $teamSelect = $playersSelect.parent().parent().parent().find(".field-team select");

                    // Фильтрация поля
                    $.getJSON("/league/get-players/" + $teamSelect.val(), function (data) {
                        var options = '<option value="">---------</option>';
                        for (var i = 0; i < data.length; i++) {
                            options += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
                        }

                        $playersSelect.html(options);

                        // Присваивание текущего значения игрока
                        $playersSelect.val(playerVal);
                        $playersSelect.prop("disabled", false);
                    });
                }
            });

            // Фильтрация игроков при смене команды
            $(document).on('change', ".field-team select", function () {
                var $this = $(this);
                var $playersSelect = $this.parent().parent().parent().find(".field-player select");

                $playersSelect.prop("disabled", "disabled");

                $.getJSON("/league/get-players/" + $this.val(), function (data) {
                    var options = '<option value="">---------</option>';
                    for (var i = 0; i < data.length; i++) {
                        options += '<option value="' + data[i].id + '">' + data[i].name + '</option>';
                    }

                    $playersSelect.html(options);
                    $playersSelect.prop("disabled", false);
                });
            });
        });
    </script>
{% endblock %}